<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SADTF - Sistema de Archivos Distribuido</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
    <div class="toast-container" id="toast-container"></div>

    <header>
        <h1>üìÅ SADTF</h1>
        <p class="subtitle">Sistema de Archivos Distribuido Tolerante a Fallas</p>
        <span class="node-badge">üñ•Ô∏è Nodo: {{ node_name }}</span>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="total-files">0</div>
                <div class="stat-label">Archivos</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="total-blocks">0</div>
                <div class="stat-label">Bloques</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="nodes-online">0</div>
                <div class="stat-label">Nodos Online</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="total-space">0 MB</div>
                <div class="stat-label">Espacio Usado</div>
            </div>
        </div>
    </header>

    <div class="actions">
        <input type="file" id="file-input" class="file-input" />
        <label for="file-input" class="file-input-label btn-success">üì§ Cargar Archivo</label>
        <button id="btn-download" class="btn-primary" disabled>üì• Descargar</button>
        <button id="btn-attributes" class="btn-info" disabled>üìã Atributos</button>
        <button id="btn-delete" class="btn-danger" disabled>üóëÔ∏è Eliminar</button>
        <button id="btn-block-table" class="btn-warning">üìä Tabla de Bloques</button>
    </div>

    <div class="progress-container" id="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-text" id="progress-text">Subiendo archivo...</div>
    </div>

    <div class="main-container">
        <div class="panel">
            <h2>üìÅ Archivos Distribuidos</h2>
            <p style="color:#888; font-size:0.85em; margin-bottom:15px;">
                Los archivos se distribuyen autom√°ticamente entre todos los nodos con r√©plicas
            </p>
            <ul class="file-list" id="distributed-files">
                <li class="empty-message">Cargando archivos...</li>
            </ul>
        </div>

        <div class="panel">
            <h2>üñ•Ô∏è Estado de Nodos</h2>
            <div id="nodes-status">
                {% for name, info in nodes.items() %}
                <div class="node-item">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <span class="node-status offline" id="status-{{ name }}"></span>
                            <strong>{{ name }}</strong>
                            {% if name == node_name %}<span style="color:#00ff88; font-size:0.8em;">(Este nodo)</span>{%
                            endif %}
                        </div>
                        <span class="file-size" id="capacity-text-{{ name }}">0 / {{ node_capacity.get(name, 50) }}
                            MB</span>
                    </div>
                    <div class="capacity-bar">
                        <div class="capacity-fill" id="capacity-{{ name }}" style="width: 0%;"></div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Modal Atributos -->
    <div id="modal-attributes" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìã Atributos del Archivo</h3>
                <button class="close-btn" onclick="closeModal('modal-attributes')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="attributes-grid" id="attributes-grid"></div>
                <h4 style="color: #00d4ff; margin: 20px 0 10px;">üì¶ Distribuci√≥n de Bloques</h4>
                <p style="color:#888; font-size:0.85em; margin-bottom:15px;">
                    Cada bloque tiene un nodo primario y una r√©plica en otro nodo diferente
                </p>
                <table class="block-table">
                    <thead>
                        <tr>
                            <th># Bloque</th>
                            <th>Tama√±o</th>
                            <th>Nodo Primario</th>
                            <th>Nodo R√©plica</th>
                            <th>Hash MD5</th>
                        </tr>
                    </thead>
                    <tbody id="blocks-detail"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal Tabla de Bloques -->
    <div id="modal-block-table" class="modal">
        <div class="modal-content" style="max-width: 1100px;">
            <div class="modal-header">
                <h3>üìä Tabla de Bloques del Sistema</h3>
                <button class="close-btn" onclick="closeModal('modal-block-table')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="attributes-grid" id="system-stats"></div>
                <h4 style="color: #00d4ff; margin: 20px 0 10px;">Todos los Bloques del Sistema</h4>
                <table class="block-table">
                    <thead>
                        <tr>
                            <th>ID Bloque</th>
                            <th>Archivo</th>
                            <th># Bloque</th>
                            <th>Tama√±o</th>
                            <th>Nodo Primario</th>
                            <th>Nodo R√©plica</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody id="all-blocks"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>